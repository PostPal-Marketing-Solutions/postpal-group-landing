---
import { Image } from 'astro:assets'
import type { ImageMetadata } from 'astro'

type Props = {
	previewImage: ImageMetadata
	downloadUrl: string
	highlightStyle?: 'default' | 'handwritten'
	mediaStyle?: 'default' | 'image-only'
	badgeText?: string
	titlePrefix?: string
	titleHighlight?: string
	leadText?: string
	freeNoteText?: string
	emailPlaceholder?: string
	primaryCtaLabel?: string
	secondaryCtaLabel?: string
	mediaEyebrow?: string
	mediaTitle?: string
}

const {
	previewImage,
	downloadUrl,
	highlightStyle = 'default',
	mediaStyle = 'default',
	badgeText = 'Kostenloses CRM Playbook 2026',
	titlePrefix = 'Von Einzelaktionen zu planbarem Wachstum mit',
	titleHighlight = 'Print-Mailing-Workflows in 2026',
	leadText = 'Das 24-seitige Playbook zeigt dir, wie D2C-Teams Print-Mailings mit CRM-Logik verknüpfen, Kampagnen sauber priorisieren und Wiederkäufe messbar steigern.',
	freeNoteText = '100% KOSTENLOS: Digitaler Download, kein Abo-Zwang, keine versteckten Kosten.',
	emailPlaceholder = 'E-Mail-Adresse eingeben',
	primaryCtaLabel = 'Playbook herunterladen',
	secondaryCtaLabel = 'Kostenlosen CRM-Check buchen',
	mediaEyebrow = 'DOWNLOAD PDF',
	mediaTitle = 'CRM Print-Mailing Playbook 2026'
} = Astro.props

const heroImageSizes =
	mediaStyle === 'image-only' ? '(min-width: 1024px) 48vw, 92vw' : '(min-width: 1024px) 36vw, 88vw'

const highlightHandwrittenSegments = titleHighlight.replace(/\s+/g, ' ').trim().split('-').filter(Boolean)
---

<section class:list={['simple-hero', { 'simple-hero--image-only': mediaStyle === 'image-only' }]}>
	<div class="simple-hero__content">
		<div class="simple-hero__copy">
			<p class="simple-hero__badge">
				{badgeText}
			</p>

			<h1>
				{titlePrefix}
				<span
					class:list={[
						'simple-hero__title-highlight',
						{
							'simple-hero__title-highlight--handwritten': highlightStyle === 'handwritten'
						}
					]}
				>
					{
						highlightStyle === 'handwritten' ? (
							<span class="simple-hero__title-highlight-text simple-hero__title-highlight-text--handwritten">
								{
									highlightHandwrittenSegments.map((segment, index) => (
										<>
											<span>{segment}</span>
											{
												index < highlightHandwrittenSegments.length - 1 && (
													<>
														<wbr />
														<span aria-hidden="true">-</span>
														<wbr />
													</>
												)
											}
										</>
									))
								}
							</span>
						) : (
							<span class="simple-hero__title-highlight-text">{titleHighlight}</span>
						)
					}
				</span>
			</h1>

			<p class="simple-hero__lead">{leadText}</p>
			{mediaStyle !== 'image-only' && <p class="simple-hero__free-note">{freeNoteText}</p>}
		</div>

		<div class="simple-hero__media-wrap">
			<div
				class:list={[
					'simple-hero__media-card',
					{
						'simple-hero__media-card--image-only': mediaStyle === 'image-only'
					}
				]}
			>
				<Image
					src={previewImage}
					alt="Playbook Cover"
					class="simple-hero__media-image"
					widths={[480, 720, 960]}
					sizes={heroImageSizes}
					loading="eager"
					fetchpriority="high"
					decoding="async"
				/>
				{
					mediaStyle !== 'image-only' && (
						<>
							<p>{mediaEyebrow}</p>
							<h2>{mediaTitle}</h2>
						</>
					)
				}
				{mediaStyle === 'image-only' && <p class="simple-hero__free-note">{freeNoteText}</p>}
			</div>
		</div>

		<div class="simple-hero__capture-row">
			<p class="simple-hero__warning" data-invalid-known-link hidden>
				Der persönliche Link ist nicht mehr gültig. Nutze den regulären Download-Flow.
			</p>

			<div data-state-block="gated">
				<div class="simple-hero__capture">
					<form class="simple-hero__form" data-lead-form novalidate>
						<input
							type="email"
							data-email-input
							name="email"
							placeholder={emailPlaceholder}
							autocomplete="email"
							required
						/>
						<button type="submit">{primaryCtaLabel}</button>
					</form>

					<label class="simple-hero__consent" for="simple-hero-consent">
						<input id="simple-hero-consent" data-consent-input type="checkbox" />
						<span>
							Ich stimme zu, den Newsletter mit CRM-Insights zu erhalten. Abmeldung jederzeit möglich.
							Datenschutzkonform.
						</span>
					</label>
				</div>
			</div>

			<div data-state-block="submitted" hidden>
				<p class="simple-hero__success-text">
					Perfekt, der Download ist bereit.<span data-last-email></span>
				</p>
				<div class="simple-hero__actions">
					<a href={downloadUrl} download data-track-download>{primaryCtaLabel}</a>
					<a href="https://calendly.com/postpal-felix/postpal-kennenlernen" data-track-secondary>
						{secondaryCtaLabel}
					</a>
				</div>
			</div>

			<div data-state-block="known" hidden>
				<p class="simple-hero__success-text"><span data-known-greeting>Hallo</span></p>
				<div class="simple-hero__actions">
					<a href={downloadUrl} download data-track-download>{primaryCtaLabel}</a>
					<a href="https://calendly.com/postpal-felix/postpal-kennenlernen" data-track-secondary>
						{secondaryCtaLabel}
					</a>
				</div>
			</div>
		</div>
	</div>
</section>

<style>
	.simple-hero {
		@apply w-full py-6 lg:py-10;
	}

	.simple-hero__content {
		@apply mx-auto grid w-full max-w-7xl gap-8 px-4 sm:px-6 lg:grid-cols-[1fr_0.92fr] lg:items-center;
	}

	.simple-hero--image-only .simple-hero__content {
		@apply lg:grid-cols-[minmax(0,1fr)_minmax(620px,1.35fr)] lg:gap-10;
	}

	.simple-hero__copy h1 {
		@apply mb-4 text-5xl font-bold leading-[0.98] text-neutral-900 lg:text-7xl;
		font-family: 'Outfit Variable', 'Roboto', sans-serif;
	}

	.simple-hero__title-highlight {
		@apply text-primary-600;
		display: inline;
		margin-left: 0.1em;
	}

	.simple-hero__title-highlight-text {
		display: inline-block;
	}

	.simple-hero__title-highlight--handwritten {
		display: inline;
		font-family: 'Covered By Your Grace', 'Outfit Variable', 'Roboto', cursive;
		font-weight: 400;
		letter-spacing: -0.022em;
		word-spacing: -0.2em;
		line-height: 0.9;
		font-size: 1.22em;
		color: #004f44;
		transform: translateY(0.01em) rotate(-0.65deg);
	}

	.simple-hero__title-highlight-text--handwritten {
		display: inline;
		overflow-wrap: normal;
		word-break: normal;
	}

	.simple-hero__badge {
		@apply mb-4 text-[0.8rem] font-semibold uppercase tracking-[0.14em] text-primary-700;
	}

	.simple-hero__lead {
		@apply mb-5 max-w-2xl text-lg leading-relaxed text-neutral-600;
	}

	.simple-hero__free-note {
		@apply mb-5 block w-full rounded-lg border border-primary-200 bg-primary-50 px-3 py-2 text-sm font-semibold text-primary-800;
	}

	.simple-hero__media-card .simple-hero__free-note {
		width: fit-content;
		max-width: 100%;
		margin-left: auto;
		margin-right: auto;
		text-align: center;
	}

	.simple-hero__form {
		@apply flex w-full flex-col gap-3 sm:flex-row;
	}

	.simple-hero__capture {
		@apply w-full rounded-2xl border border-neutral-200/60 p-4 sm:p-5;
		background: #f8f9f9;
	}

	.simple-hero__capture-row {
		@apply mt-2 w-full;
		grid-column: 1 / -1;
	}

	.simple-hero__form input {
		@apply h-12 min-h-[52px] w-full flex-1 rounded-xl border border-neutral-200/90 bg-white px-4 text-base leading-none text-neutral-800 outline-none placeholder:text-neutral-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-200;
		appearance: none;
	}

	.simple-hero__form button,
	.simple-hero__actions a:first-child {
		@apply inline-flex h-12 min-h-[52px] w-full items-center justify-center rounded-xl bg-primary-600 px-6 text-base font-semibold text-white transition hover:bg-primary-500 sm:w-auto;
	}

	.simple-hero__consent {
		@apply mt-4 flex items-start gap-3 text-sm leading-relaxed text-neutral-500;
	}

	.simple-hero__consent input {
		@apply mt-0.5 h-5 w-5 shrink-0 rounded border-neutral-200/90 bg-white;
	}

	.simple-hero__success-text {
		@apply mb-3 text-base font-medium text-neutral-700;
	}

	.simple-hero__actions {
		@apply flex flex-col gap-3 sm:flex-row;
	}

	.simple-hero__actions a:last-child {
		@apply inline-flex h-12 min-h-[52px] w-full items-center justify-center rounded-xl border border-neutral-200/90 bg-white px-6 text-base font-semibold text-neutral-700 transition hover:bg-neutral-100 sm:w-auto;
	}

	.simple-hero__warning {
		@apply mb-3 rounded-lg border border-accent-300 bg-accent-50 px-3 py-2 text-sm font-medium text-accent-900;
	}

	.simple-hero__media-wrap {
		@apply flex justify-center lg:justify-end;
		position: relative;
	}

	.simple-hero__media-card {
		@apply w-full max-w-[620px] rounded-[1.8rem] border border-white/65 bg-white/55 p-4;
		backdrop-filter: blur(10px);
		box-shadow:
			0 20px 44px rgba(15, 23, 42, 0.12),
			0 3px 12px rgba(15, 23, 42, 0.08),
			inset 0 1px 0 rgba(255, 255, 255, 0.72);
		transform: translateY(6px);
	}

	.simple-hero__media-card--image-only {
		@apply max-w-[780px] border-0 bg-transparent p-0;
		backdrop-filter: none;
		box-shadow: none;
		transform: none;
	}

	.simple-hero__media-image {
		@apply h-auto w-full rounded-[1.15rem] object-contain object-center;
		border: 0;
		aspect-ratio: auto;
		box-shadow: none;
		background: transparent;
	}

	.simple-hero__media-card p {
		@apply mb-1 mt-4 text-xs font-semibold uppercase tracking-[0.12em] text-neutral-600;
	}

	.simple-hero__media-card h2 {
		@apply text-[2.55rem] font-semibold text-neutral-900;
		font-family: 'Outfit Variable', 'Roboto', sans-serif;
		letter-spacing: -0.02em;
	}

	@media (min-width: 1024px) {
		.simple-hero__content {
			@apply gap-12 lg:grid-cols-[minmax(0,1fr)_minmax(520px,1.1fr)];
		}
	}

	@media (max-width: 640px) {
		.simple-hero__copy h1 {
			@apply text-[2.75rem] leading-[1.02];
		}

		.simple-hero__title-highlight {
			margin-left: 0.06em;
		}

		.simple-hero__title-highlight--handwritten {
			transform: none;
			font-size: 1.1em;
			letter-spacing: -0.01em;
			word-spacing: -0.28em;
			line-height: 0.9;
		}

		.simple-hero__lead {
			@apply text-base;
		}

		.simple-hero__badge {
			@apply max-w-full text-[0.68rem] tracking-[0.12em];
		}

		.simple-hero__consent {
			@apply text-base leading-7;
		}

		.simple-hero__form input,
		.simple-hero__form button,
		.simple-hero__actions a:first-child,
		.simple-hero__actions a:last-child {
			@apply min-h-[56px] text-lg;
		}

		.simple-hero__media-card {
			@apply p-4;
			transform: none;
			max-width: 560px;
		}

		.simple-hero__media-card h2 {
			@apply text-[2rem];
		}
	}
</style>
